# Migration `20201202065804-base-schema`

This migration has been generated by Ben Galloway at 12/2/2020, 6:58:04 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."Visibility" AS ENUM ('VISIBLE', 'HIDDEN')

CREATE TYPE "public"."UserContactType" AS ENUM ('ADDRESS', 'EMAIL', 'PHONE', 'CUSTOM')

CREATE TYPE "public"."ArchiveItemType" AS ENUM ('MINUTES', 'PHOTOS')

CREATE TYPE "public"."ArchiveFileKind" AS ENUM ('TRANSCRIPTION', 'SCAN', 'PREVIOUSLY_DIGITISED', 'CREATED_DIGITALLY')

CREATE TYPE "public"."EventType" AS ENUM ('SHOW', 'ANNIVERSARY', 'EVENT')

CREATE TYPE "public"."RoleType" AS ENUM ('PERFORMANCE', 'PRODUCTION', 'COMMITTEE', 'SOCIETY')

CREATE TYPE "public"."TagType" AS ENUM ('YEAR', 'EVENT', 'ROLE')

CREATE TYPE "public"."ArchiveCollectionType" AS ENUM ('PHYSICAL', 'SYSTEM', 'USER')

CREATE TYPE "public"."ArchiveCollectionViewPerms" AS ENUM ('PUBLIC', 'PRIVATE')

CREATE TYPE "public"."ArchiveCollectionEditPerms" AS ENUM ('OPEN', 'CLOSED')

CREATE TABLE "User" (
"id" SERIAL,
    "subject" TEXT NOT NULL,
    "slug" TEXT NOT NULL,
    "verifiedByKeyId" INTEGER NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "deletedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "UserRole" (
"id" SERIAL,
    "roleName" TEXT NOT NULL,
    "accessLevel" INTEGER NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "UserProfile" (
"id" SERIAL,
    "userId" INTEGER NOT NULL,
    "cecilianId" INTEGER,
    "title" TEXT,
    "firstNames" TEXT,
    "lastNames" TEXT,
    "otherNames" TEXT[],
    "visibility" "Visibility" NOT NULL DEFAULT E'VISIBLE',
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "deletedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "UserContact" (
"id" SERIAL,
    "userProfileId" INTEGER NOT NULL,
    "type" "UserContactType" NOT NULL,
    "customType" TEXT,
    "value" TEXT NOT NULL,
    "notes" TEXT,
    "visibility" "Visibility" NOT NULL DEFAULT E'VISIBLE',
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "deletedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "Anniversary60Profile" (
"id" SERIAL,
    "userProfileId" INTEGER,
    "title" TEXT NOT NULL,
    "firstname" TEXT NOT NULL,
    "surname" TEXT NOT NULL,
    "prevNames" TEXT NOT NULL,
    "address" TEXT NOT NULL,
    "email" TEXT NOT NULL,
    "phone" TEXT NOT NULL,
    "otherInfo" TEXT NOT NULL,
    "wouldLikeTo" TEXT NOT NULL,
    "dietary" TEXT NOT NULL,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "AccessKey" (
"id" SERIAL,
    "key" TEXT NOT NULL,
    "ownerId" INTEGER,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "removedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "Cecilian" (
"id" SERIAL,
    "slug" TEXT NOT NULL,
    "displayName" TEXT NOT NULL,
    "otherNames" TEXT[],
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "deletedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "ArchiveItemCecilian" (
"id" SERIAL,
    "cecilianId" INTEGER,
    "itemId" INTEGER,
    "addedAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "removedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "ArchiveItem" (
"id" SERIAL,
    "slug" TEXT NOT NULL,
    "archiveRef" TEXT NOT NULL,
    "type" "ArchiveItemType" NOT NULL,
    "associatedDate" TIMESTAMP(3),
    "notes" TEXT,
    "authorId" INTEGER,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "deletedAt" TIMESTAMP(3),
    "createdById" INTEGER,
    "updatedById" INTEGER,

    PRIMARY KEY ("id")
)

CREATE TABLE "ArchiveFile" (
"id" SERIAL,
    "slug" TEXT NOT NULL,
    "kind" "ArchiveFileKind" NOT NULL,
    "name" TEXT NOT NULL,
    "notes" TEXT,
    "url" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "deletedAt" TIMESTAMP(3),
    "deletedById" INTEGER,

    PRIMARY KEY ("id")
)

CREATE TABLE "ArchiveItemFile" (
"id" SERIAL,
    "fileId" INTEGER,
    "itemId" INTEGER,
    "addedAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "removedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "Year" (
"id" SERIAL,
    "slug" TEXT NOT NULL,
    "name" TEXT NOT NULL,
    "startDate" TIMESTAMP(3),
    "endDate" TIMESTAMP(3),
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "deletedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "Event" (
"id" SERIAL,
    "type" "EventType" NOT NULL,
    "name" TEXT NOT NULL,
    "inherentYearId" INTEGER,
    "startDate" TIMESTAMP(3),
    "endDate" TIMESTAMP(3),
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "deletedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "Role" (
"id" SERIAL,
    "type" "RoleType" NOT NULL,
    "name" TEXT NOT NULL,
    "inherentEventId" INTEGER,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "deletedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "Tag" (
"id" SERIAL,
    "type" "TagType" NOT NULL,
    "roleId" INTEGER,
    "eventId" INTEGER,
    "yearId" INTEGER,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "deletedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "CecilianTag" (
"id" SERIAL,
    "cecilianId" INTEGER NOT NULL,
    "tagId" INTEGER NOT NULL,
    "addedAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "removedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "ArchiveItemTag" (
"id" SERIAL,
    "itemId" INTEGER NOT NULL,
    "tagId" INTEGER NOT NULL,
    "addedAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "removedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "ArchiveCollection" (
"id" SERIAL,
    "slug" TEXT NOT NULL,
    "type" "ArchiveCollectionType" NOT NULL,
    "name" TEXT NOT NULL,
    "description" TEXT,
    "physicalLocation" TEXT,
    "ownerId" INTEGER,
    "viewPerms" "ArchiveCollectionViewPerms" NOT NULL DEFAULT E'PUBLIC',
    "editPerms" "ArchiveCollectionEditPerms" NOT NULL DEFAULT E'OPEN',
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "createdById" INTEGER NOT NULL,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "updatedById" INTEGER,
    "deletedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "CollectionItem" (
"id" SERIAL,
    "itemId" INTEGER NOT NULL,
    "collectionId" INTEGER NOT NULL,
    "itemIndex" TEXT,
    "addedById" INTEGER,
    "addedAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,
    "removedAt" TIMESTAMP(3),

    PRIMARY KEY ("id")
)

CREATE TABLE "LogEntry" (
"id" SERIAL,
    "timestamp" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "logLevel" TEXT NOT NULL,
    "logLine" TEXT NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "_UserToUserRole" (
    "A" INTEGER NOT NULL,
    "B" INTEGER NOT NULL
)

CREATE UNIQUE INDEX "User.subject_unique" ON "User"("subject")

CREATE UNIQUE INDEX "User.slug_unique" ON "User"("slug")

CREATE UNIQUE INDEX "UserProfile_userId_unique" ON "UserProfile"("userId")

CREATE UNIQUE INDEX "UserProfile_cecilianId_unique" ON "UserProfile"("cecilianId")

CREATE UNIQUE INDEX "Anniversary60Profile_userProfileId_unique" ON "Anniversary60Profile"("userProfileId")

CREATE UNIQUE INDEX "AccessKey.key_unique" ON "AccessKey"("key")

CREATE UNIQUE INDEX "AccessKey_ownerId_unique" ON "AccessKey"("ownerId")

CREATE UNIQUE INDEX "Cecilian.slug_unique" ON "Cecilian"("slug")

CREATE UNIQUE INDEX "ArchiveItem.slug_unique" ON "ArchiveItem"("slug")

CREATE UNIQUE INDEX "ArchiveFile.slug_unique" ON "ArchiveFile"("slug")

CREATE UNIQUE INDEX "Year.slug_unique" ON "Year"("slug")

CREATE UNIQUE INDEX "ArchiveCollection.slug_unique" ON "ArchiveCollection"("slug")

CREATE UNIQUE INDEX "_UserToUserRole_AB_unique" ON "_UserToUserRole"("A", "B")

CREATE INDEX "_UserToUserRole_B_index" ON "_UserToUserRole"("B")

ALTER TABLE "User" ADD FOREIGN KEY("verifiedByKeyId")REFERENCES "AccessKey"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "UserProfile" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "UserProfile" ADD FOREIGN KEY("cecilianId")REFERENCES "Cecilian"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "UserContact" ADD FOREIGN KEY("userProfileId")REFERENCES "UserProfile"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Anniversary60Profile" ADD FOREIGN KEY("userProfileId")REFERENCES "UserProfile"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "AccessKey" ADD FOREIGN KEY("ownerId")REFERENCES "UserProfile"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "ArchiveItemCecilian" ADD FOREIGN KEY("cecilianId")REFERENCES "Cecilian"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "ArchiveItemCecilian" ADD FOREIGN KEY("itemId")REFERENCES "ArchiveItem"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "ArchiveItem" ADD FOREIGN KEY("authorId")REFERENCES "Cecilian"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "ArchiveItem" ADD FOREIGN KEY("createdById")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "ArchiveItem" ADD FOREIGN KEY("updatedById")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "ArchiveFile" ADD FOREIGN KEY("deletedById")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "ArchiveItemFile" ADD FOREIGN KEY("fileId")REFERENCES "ArchiveFile"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "ArchiveItemFile" ADD FOREIGN KEY("itemId")REFERENCES "ArchiveItem"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Event" ADD FOREIGN KEY("inherentYearId")REFERENCES "Year"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Role" ADD FOREIGN KEY("inherentEventId")REFERENCES "Event"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Tag" ADD FOREIGN KEY("roleId")REFERENCES "Role"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Tag" ADD FOREIGN KEY("eventId")REFERENCES "Event"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Tag" ADD FOREIGN KEY("yearId")REFERENCES "Year"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "CecilianTag" ADD FOREIGN KEY("cecilianId")REFERENCES "Cecilian"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "CecilianTag" ADD FOREIGN KEY("tagId")REFERENCES "Tag"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "ArchiveItemTag" ADD FOREIGN KEY("itemId")REFERENCES "ArchiveItem"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "ArchiveItemTag" ADD FOREIGN KEY("tagId")REFERENCES "Tag"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "ArchiveCollection" ADD FOREIGN KEY("ownerId")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "ArchiveCollection" ADD FOREIGN KEY("createdById")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "ArchiveCollection" ADD FOREIGN KEY("updatedById")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "CollectionItem" ADD FOREIGN KEY("itemId")REFERENCES "ArchiveItem"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "CollectionItem" ADD FOREIGN KEY("collectionId")REFERENCES "ArchiveCollection"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "CollectionItem" ADD FOREIGN KEY("addedById")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "_UserToUserRole" ADD FOREIGN KEY("A")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_UserToUserRole" ADD FOREIGN KEY("B")REFERENCES "UserRole"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201202065804-base-schema
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,380 @@
+datasource DS {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider      = "prisma-client-js"
+  binaryTargets = "native"
+}
+
+// ---------------------------------------------------------
+//
+//  CECILIAN ARCHIVE
+//  Database Schema
+//  --BAG 10 November 2020
+//
+///
+/// "Archiving is as much about pruning the hedge
+/// as it is about making sure it grows properly."
+/// -- Robyn Hunter
+///    12 January 2020
+///
+// ---------------------------------------------------------
+
+
+// ---------------------------------------------------------
+//
+//  USERS AND PROFILES
+//
+// ---------------------------------------------------------
+
+model User {
+  id                   Int        @id @default(autoincrement())
+  subject              String     @unique // The user's identifier in Auth0
+  slug                 String     @unique // An in-app identifier e.g. for URLs
+  profile              UserProfile? @relation("ProfileOwner")
+  verifiedByKey        AccessKey  @relation("AccessKeyUser", fields: [verifiedByKeyId], references: [id])
+  verifiedByKeyId      Int
+  roles                UserRole[]
+  createdAt            DateTime   @default(now())
+  updatedAt            DateTime   @updatedAt
+  deletedAt            DateTime?
+  archiveItemsCreated  ArchiveItem[]       @relation("ItemCreatedBy")
+  collectionsOwned     ArchiveCollection[] @relation("CollectionOwner")
+  collectionsCreated   ArchiveCollection[] @relation("CollectionCreatedBy")
+}
+
+model UserRole {
+  id           Int       @id @default(autoincrement())
+  roleName     String
+  accessLevel  Int
+  users        User[]
+}
+
+model UserProfile {
+  id             Int        @id @default(autoincrement())
+  user           User       @relation("ProfileOwner", fields: [userId], references: [id])
+  userId         Int
+  cecilian       Cecilian?  @relation("ProfileCecilian", fields: [cecilianId], references: [id])
+  cecilianId     Int?
+  accessKey      AccessKey? @relation("AccessKeyOwner")
+  title          String?
+  firstNames     String?
+  lastNames      String?
+  otherNames     String[]
+  contactDetails UserContact[]
+  anniversary60  Anniversary60Profile? @relation("Profile60th")
+  visibility     Visibility @default(VISIBLE)
+  createdAt      DateTime   @default(now())
+  updatedAt      DateTime   @updatedAt
+  deletedAt      DateTime?
+}
+enum Visibility {
+  VISIBLE
+  HIDDEN
+}
+
+model UserContact {
+  id            Int          @id @default(autoincrement())
+  userProfile   UserProfile  @relation(fields: [userProfileId], references: [id])
+  userProfileId Int
+  type          UserContactType
+  customType    String?
+  value         String
+  notes         String?
+  visibility    Visibility   @default(VISIBLE)
+  createdAt     DateTime     @default(now())
+  updatedAt     DateTime     @updatedAt
+  deletedAt     DateTime?
+}
+enum UserContactType {
+  ADDRESS
+  EMAIL
+  PHONE
+  CUSTOM
+}
+
+model Anniversary60Profile {
+  id            Int          @id @default(autoincrement())
+  userProfile   UserProfile? @relation("Profile60th", fields: [userProfileId], references: [id])
+  userProfileId Int?
+  title         String
+  firstname     String
+  surname       String
+  prevNames     String
+  address       String
+  email         String
+  phone         String
+  otherInfo     String
+  wouldLikeTo   String
+  dietary       String
+  updatedAt     DateTime
+}
+
+model AccessKey {
+  id         Int          @id @default(autoincrement())
+  key        String       @unique
+  owner      UserProfile? @relation("AccessKeyOwner", fields: [ownerId], references: [id])
+  ownerId    Int?
+  usedBy     User[]       @relation("AccessKeyUser")
+  createdAt  DateTime     @default(now())
+  updatedAt  DateTime     @updatedAt
+  removedAt  DateTime?
+}
+
+
+// ---------------------------------------------------------
+//
+//  CECILIANS AND ARCHIVE ITEMS
+//
+// ---------------------------------------------------------
+
+model Cecilian {
+  id         Int     @id @default(autoincrement())
+  slug       String  @unique
+  displayName String
+  otherNames String[]
+  user       UserProfile? @relation("ProfileCecilian")
+  tags       CecilianTag[] /// Years, Events, Roles
+  inArchiveItems ArchiveItemCecilian[]
+  authoredArchiveItems ArchiveItem[] @relation("ItemAuthor")
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
+  deletedAt  DateTime?
+}
+
+model ArchiveItemCecilian {
+  id         Int     @id @default(autoincrement())
+  cecilian   Cecilian? @relation(fields: [cecilianId], references: [id])
+  cecilianId Int?
+  item       ArchiveItem? @relation(fields: [itemId], references: [id])
+  itemId     Int?
+  addedAt    DateTime @default(now())
+  removedAt  DateTime?
+}
+
+model ArchiveItem {
+  id              Int     @id @default(autoincrement())
+  slug            String  @unique
+  archiveRef      String
+  type            ArchiveItemType
+  associatedDate  DateTime?
+  collections     CollectionItem[]
+  notes           String?
+  author          Cecilian? @relation("ItemAuthor", fields: [authorId], references: [id])
+  authorId        Int?
+  tags            ArchiveItemTag[] /// Years, Events, Roles
+  cecilians       ArchiveItemCecilian[]
+  files           ArchiveItemFile[]
+  createdAt       DateTime @default(now())
+  updatedAt       DateTime @updatedAt
+  deletedAt       DateTime?
+  createdBy       User? @relation("ItemCreatedBy", fields: [createdById], references: [id])
+  createdById     Int?
+  updatedBy       User? @relation("ItemUpdatedBy", fields: [updatedById], references: [id])
+  updatedById     Int?
+}
+enum ArchiveItemType {
+  MINUTES
+  PHOTOS
+}
+
+model ArchiveFile {
+  id          Int     @id @default(autoincrement())
+  slug        String  @unique
+  kind        ArchiveFileKind
+  name        String
+  notes       String?
+  url         String
+  items       ArchiveItemFile[]
+  createdAt   DateTime @default(now())
+  updatedAt   DateTime @updatedAt
+  deletedAt   DateTime?
+  deletedBy   User? @relation("FileDeletedBy", fields: [deletedById], references: [id])
+  deletedById Int?
+}
+enum ArchiveFileKind {
+  TRANSCRIPTION
+  SCAN
+  PREVIOUSLY_DIGITISED
+  CREATED_DIGITALLY
+}
+
+model ArchiveItemFile {
+  id         Int     @id @default(autoincrement())
+  file       ArchiveFile? @relation(fields: [fileId], references: [id])
+  fileId     Int?
+  item       ArchiveItem? @relation(fields: [itemId], references: [id])
+  itemId     Int?
+  addedAt    DateTime @default(now())
+  removedAt  DateTime?
+}
+
+
+// ---------------------------------------------------------
+//
+//  TAGS AND THEIR RELATIONSHIPS
+//
+// ---------------------------------------------------------
+
+model Year {
+  id         Int     @id @default(autoincrement())
+  slug       String  @unique /// e.g. 2010-2011
+  name       String
+  startDate  DateTime?
+  endDate    DateTime?
+  events     Event[] /// Backlinks
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
+  deletedAt  DateTime?
+  inTags     Tag[]
+}
+
+model Event {
+  id             Int      @id @default(autoincrement())
+  type           EventType
+  name           String
+  inherentYear   Year?    @relation(fields: [inherentYearId], references: [id])
+  inherentYearId Int?
+  roles          Role[] /// Backlinks
+  startDate      DateTime?
+  endDate        DateTime?
+  createdAt      DateTime @default(now())
+  updatedAt      DateTime @updatedAt
+  deletedAt      DateTime?
+  inTags         Tag[]
+}
+enum EventType {
+  SHOW
+  ANNIVERSARY
+  EVENT
+}
+
+model Role {
+  id              Int      @id @default(autoincrement())
+  type            RoleType
+  name            String
+  inherentEvent   Event?   @relation(fields: [inherentEventId], references: [id])
+  inherentEventId Int?
+  createdAt       DateTime @default(now())
+  updatedAt       DateTime @updatedAt
+  deletedAt       DateTime?
+  inTags          Tag[]
+}
+enum RoleType {
+  PERFORMANCE
+  PRODUCTION
+  COMMITTEE
+  SOCIETY
+}
+
+model Tag {
+  id            Int      @id @default(autoincrement())
+  type          TagType
+  role          Role?    @relation(fields: [roleId], references: [id])
+  roleId        Int?
+  event         Event?   @relation(fields: [eventId], references: [id])
+  eventId       Int?
+  year          Year?    @relation(fields: [yearId], references: [id])
+  yearId        Int?
+  createdAt     DateTime @default(now())
+  updatedAt     DateTime @updatedAt
+  deletedAt     DateTime?
+  cecilians     CecilianTag[]
+  archiveItems  ArchiveItemTag[]
+}
+enum TagType {
+  YEAR
+  EVENT
+  ROLE
+}
+
+model CecilianTag {
+  id          Int      @id @default(autoincrement())
+  cecilian    Cecilian @relation(fields: [cecilianId], references: [id])
+  cecilianId  Int
+  tag         Tag      @relation(fields: [tagId], references: [id])
+  tagId       Int
+  addedAt     DateTime @default(now())
+  removedAt   DateTime?
+}
+
+model ArchiveItemTag {
+  id         Int         @id @default(autoincrement())
+  item       ArchiveItem @relation(fields: [itemId], references: [id])
+  itemId     Int
+  tag        Tag         @relation(fields: [tagId], references: [id])
+  tagId      Int
+  addedAt    DateTime    @default(now())
+  removedAt  DateTime?
+}
+
+
+// ---------------------------------------------------------
+//
+//  COLLECTIONS
+//
+// ---------------------------------------------------------
+
+model ArchiveCollection {
+  id          Int     @id @default(autoincrement())
+  slug        String  @unique
+  type        ArchiveCollectionType
+  name        String
+  description String?
+  physicalLocation String? /// only relevant for type: PHYSICAL
+  owner       User? @relation("CollectionOwner", fields: [ownerId], references: [id])
+  ownerId     Int?
+  viewPerms   ArchiveCollectionViewPerms @default(PUBLIC)
+  editPerms   ArchiveCollectionEditPerms @default(OPEN)
+  items       CollectionItem[]
+  createdAt   DateTime @default(now())
+  createdBy   User @relation("CollectionCreatedBy", fields: [createdById], references: [id])
+  createdById Int
+  updatedAt   DateTime @updatedAt
+  updatedBy   User? @relation("CollectionUpdatedBy", fields: [updatedById], references: [id])
+  updatedById Int?
+  deletedAt   DateTime?
+}
+enum ArchiveCollectionType {
+  PHYSICAL
+  SYSTEM
+  USER
+}
+enum ArchiveCollectionViewPerms {
+  PUBLIC
+  PRIVATE
+}
+enum ArchiveCollectionEditPerms {
+  OPEN
+  CLOSED
+}
+
+model CollectionItem {
+  id           Int     @id @default(autoincrement())
+  item         ArchiveItem     @relation(fields: [itemId], references: [id])
+  itemId       Int
+  collection   ArchiveCollection @relation(fields: [collectionId], references: [id])
+  collectionId Int
+  itemIndex    String? /// e.g. P1, the index of this item in collection A1
+  addedBy      User? @relation("CollectionItemAddedBy", fields: [addedById], references: [id])
+  addedById    Int?
+  addedAt      DateTime @default(now())
+  updatedAt    DateTime @updatedAt
+  removedAt    DateTime?
+}
+
+
+// ---------------------------------------------------------
+//
+//  AUDIT LOG
+//
+// ---------------------------------------------------------
+
+model LogEntry {
+  id         Int      @id @default(autoincrement())
+  timestamp  DateTime @default(now())
+  logLevel   String
+  logLine    String
+}
```


