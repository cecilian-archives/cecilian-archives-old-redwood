# Migration `20201110064634-base-schema`

This migration has been generated by Ben Galloway at 11/10/2020, 6:46:34 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."AccessKey" DROP COLUMN "deletedAt",
DROP COLUMN "userId",
ADD COLUMN "ownerId" integer   NOT NULL ,
ADD COLUMN "removedAt" timestamp(3)   

ALTER TABLE "public"."Cecilian" DROP COLUMN "userId"

ALTER TABLE "public"."User" DROP COLUMN "accessKeyId",
ADD COLUMN "verifiedByKeyId" integer   NOT NULL ,
ADD COLUMN "userProfileId" integer   

ALTER TABLE "public"."UserContact" DROP COLUMN "userProfileId"

CREATE TABLE "public"."CecilianInItem" (
"id" SERIAL,
"cecilianId" integer   ,
"itemId" integer   ,
"addedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"removedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ArchiveItem" (
"id" SERIAL,
"slug" text   NOT NULL ,
"archiveRef" text   NOT NULL ,
"type" "ArchiveItemType"  NOT NULL ,
"associatedDate" timestamp(3)   ,
"notes" text   ,
"authorId" integer   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"deletedAt" timestamp(3)   ,
"createdById" integer   ,
"updatedById" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ArchiveFile" (
"id" SERIAL,
"slug" text   NOT NULL ,
"kind" "ArchiveFileKind"  NOT NULL ,
"name" text   NOT NULL ,
"notes" text   ,
"url" text   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"deletedAt" timestamp(3)   ,
"deletedById" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."FileOnItem" (
"id" SERIAL,
"fileId" integer   ,
"itemId" integer   ,
"addedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"removedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Year" (
"id" SERIAL,
"slug" text   NOT NULL ,
"name" text   NOT NULL ,
"startDate" timestamp(3)   ,
"endDate" timestamp(3)   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"deletedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Event" (
"id" SERIAL,
"type" "EventType"  NOT NULL ,
"name" text   NOT NULL ,
"inherentYearId" integer   ,
"startDate" timestamp(3)   ,
"endDate" timestamp(3)   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"deletedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Role" (
"id" SERIAL,
"type" "RoleType"  NOT NULL ,
"name" text   NOT NULL ,
"inherentEventId" integer   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"deletedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Tag" (
"id" SERIAL,
"type" "TagType"  NOT NULL ,
"roleId" integer   ,
"eventId" integer   ,
"yearId" integer   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"deletedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."TagOnCecilian" (
"id" SERIAL,
"cecilianId" integer   NOT NULL ,
"tagId" integer   NOT NULL ,
"addedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"removedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."TagOnArchiveItem" (
"id" SERIAL,
"itemId" integer   NOT NULL ,
"tagId" integer   NOT NULL ,
"addedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"removedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ArchiveCollection" (
"id" SERIAL,
"slug" text   NOT NULL ,
"type" "ArchiveCollectionType"  NOT NULL ,
"name" text   NOT NULL ,
"description" text   ,
"physicalLocation" text   ,
"ownerId" integer   ,
"viewPerms" "ArchiveCollectionViewPerms"  NOT NULL DEFAULT E'PUBLIC',
"editPerms" "ArchiveCollectionEditPerms"  NOT NULL DEFAULT E'OPEN',
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"createdById" integer   NOT NULL ,
"updatedAt" timestamp(3)   NOT NULL ,
"updatedById" integer   ,
"deletedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ItemInCollection" (
"id" SERIAL,
"itemId" integer   NOT NULL ,
"collectionId" integer   NOT NULL ,
"itemIndex" text   ,
"addedById" integer   ,
"addedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"removedAt" timestamp(3)   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."AuditLog" (
"id" SERIAL,
"timestamp" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"logLine" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_UserToUserRole" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE UNIQUE INDEX "ArchiveItem.slug_unique" ON "public"."ArchiveItem"("slug")

CREATE UNIQUE INDEX "ArchiveFile.slug_unique" ON "public"."ArchiveFile"("slug")

CREATE UNIQUE INDEX "Year.slug_unique" ON "public"."Year"("slug")

CREATE UNIQUE INDEX "ArchiveCollection.slug_unique" ON "public"."ArchiveCollection"("slug")

CREATE UNIQUE INDEX "_UserToUserRole_AB_unique" ON "public"."_UserToUserRole"("A", "B")

CREATE INDEX "_UserToUserRole_B_index" ON "public"."_UserToUserRole"("B")

CREATE UNIQUE INDEX "AccessKey.key_unique" ON "public"."AccessKey"("key")

CREATE UNIQUE INDEX "AccessKey_ownerId_unique" ON "public"."AccessKey"("ownerId")

CREATE UNIQUE INDEX "Anniversary60Profile_userProfileId_unique" ON "public"."Anniversary60Profile"("userProfileId")

CREATE UNIQUE INDEX "Cecilian.slug_unique" ON "public"."Cecilian"("slug")

CREATE UNIQUE INDEX "User.slug_unique" ON "public"."User"("slug")

CREATE UNIQUE INDEX "UserProfile_cecilianId_unique" ON "public"."UserProfile"("cecilianId")

ALTER TABLE "public"."CecilianInItem" ADD FOREIGN KEY ("cecilianId")REFERENCES "public"."Cecilian"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."CecilianInItem" ADD FOREIGN KEY ("itemId")REFERENCES "public"."ArchiveItem"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."ArchiveItem" ADD FOREIGN KEY ("authorId")REFERENCES "public"."Cecilian"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."ArchiveItem" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."ArchiveItem" ADD FOREIGN KEY ("updatedById")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."ArchiveFile" ADD FOREIGN KEY ("deletedById")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."FileOnItem" ADD FOREIGN KEY ("fileId")REFERENCES "public"."ArchiveFile"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."FileOnItem" ADD FOREIGN KEY ("itemId")REFERENCES "public"."ArchiveItem"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Event" ADD FOREIGN KEY ("inherentYearId")REFERENCES "public"."Year"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Role" ADD FOREIGN KEY ("inherentEventId")REFERENCES "public"."Event"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Tag" ADD FOREIGN KEY ("roleId")REFERENCES "public"."Role"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Tag" ADD FOREIGN KEY ("eventId")REFERENCES "public"."Event"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Tag" ADD FOREIGN KEY ("yearId")REFERENCES "public"."Year"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."TagOnCecilian" ADD FOREIGN KEY ("cecilianId")REFERENCES "public"."Cecilian"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."TagOnCecilian" ADD FOREIGN KEY ("tagId")REFERENCES "public"."Tag"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."TagOnArchiveItem" ADD FOREIGN KEY ("itemId")REFERENCES "public"."ArchiveItem"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."TagOnArchiveItem" ADD FOREIGN KEY ("tagId")REFERENCES "public"."Tag"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ArchiveCollection" ADD FOREIGN KEY ("ownerId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."ArchiveCollection" ADD FOREIGN KEY ("createdById")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ArchiveCollection" ADD FOREIGN KEY ("updatedById")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."ItemInCollection" ADD FOREIGN KEY ("itemId")REFERENCES "public"."ArchiveItem"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ItemInCollection" ADD FOREIGN KEY ("collectionId")REFERENCES "public"."ArchiveCollection"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ItemInCollection" ADD FOREIGN KEY ("addedById")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."_UserToUserRole" ADD FOREIGN KEY ("A")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_UserToUserRole" ADD FOREIGN KEY ("B")REFERENCES "public"."UserRole"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."AccessKey" ADD FOREIGN KEY ("ownerId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Anniversary60Profile" ADD FOREIGN KEY ("userProfileId")REFERENCES "public"."UserProfile"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("userProfileId")REFERENCES "public"."UserProfile"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("verifiedByKeyId")REFERENCES "public"."AccessKey"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserContact" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserProfile" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."UserProfile" ADD FOREIGN KEY ("cecilianId")REFERENCES "public"."Cecilian"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201110064634-base-schema
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,377 @@
+datasource DS {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider      = "prisma-client-js"
+  binaryTargets = ["native", "rhel-openssl-1.0.x"]
+}
+
+// Slug generation function:
+// Math.random().toString(36).substring(2, 12).toLowerCase()
+// A 10-character slug allows 8.5M random generations
+// before having a 1% chance of collision
+// (by analysis of the birthday problem).
+
+///
+/// "Archiving is as much about pruning the hedge
+/// as it is about making sure it grows properly."
+/// -- Robyn Hunter
+///    12 January 2020
+///
+
+
+// ---------------------------------------------------------
+//
+//  USERS AND PROFILES
+//
+// ---------------------------------------------------------
+
+model User {
+  id                   Int        @id @default(autoincrement())
+  slug                 String     @unique // The user's ID in Auth0
+  profile              UserProfile?
+  accessKey            AccessKey? @relation("AccessKeyOwner")
+  verifiedByKey        AccessKey  @relation("AccessKeyUser", fields: [verifiedByKeyId], references: [id])
+  verifiedByKeyId      Int
+  roles                UserRole[]
+  createdAt            DateTime   @default(now())
+  updatedAt            DateTime   @updatedAt
+  deletedAt            DateTime?
+  archiveItemsCreated  ArchiveItem[]       @relation("ItemCreatedBy")
+  collectionsOwned     ArchiveCollection[] @relation("CollectionOwner")
+  collectionsCreated   ArchiveCollection[] @relation("CollectionCreatedBy")
+}
+
+model UserRole {
+  id           Int       @id @default(autoincrement())
+  roleName     String
+  accessLevel  Int
+  users        User[]
+}
+
+model UserProfile {
+  id             Int        @id @default(autoincrement())
+  user           User       @relation("ProfileOwner", fields: [userId], references: [id])
+  userId         Int
+  cecilian       Cecilian?  @relation("ProfileCecilian", fields: [cecilianId], references: [id])
+  cecilianId     Int?
+  title          String?
+  firstNames     String?
+  lastNames      String?
+  otherNames     String[]
+  contactDetails UserContact[] @relation("UserContacts")
+  anniversary60  Anniversary60Profile? @relation("Profile60th")
+  visibility     Visibility @default(VISIBLE)
+  createdAt      DateTime   @default(now())
+  updatedAt      DateTime   @updatedAt
+  deletedAt      DateTime?
+}
+enum Visibility {
+  VISIBLE
+  HIDDEN
+}
+
+model UserContact {
+  id            Int          @id @default(autoincrement())
+  user          User         @relation("UserContacts", fields: [userId], references: [id])
+  userId        Int
+  type          UserContactType
+  customType    String?
+  value         String
+  notes         String?
+  visibility    Visibility   @default(VISIBLE)
+  createdAt     DateTime     @default(now())
+  updatedAt     DateTime     @updatedAt
+  deletedAt     DateTime?
+}
+enum UserContactType {
+  ADDRESS
+  EMAIL
+  PHONE
+  CUSTOM
+}
+
+model Anniversary60Profile {
+  id            Int          @id @default(autoincrement())
+  userProfile   UserProfile? @relation("Profile60th", fields: [userProfileId], references: [id])
+  userProfileId Int?
+  title         String
+  firstname     String
+  surname       String
+  prevNames     String
+  address       String
+  email         String
+  phone         String
+  otherInfo     String
+  wouldLikeTo   String
+  dietary       String
+  updatedAt     DateTime
+}
+
+model AccessKey {
+  id         Int       @id @default(autoincrement())
+  key        String    @unique
+  owner      User      @relation("AccessKeyOwner", fields: [ownerId], references: [id])
+  ownerId    Int
+  usedBy     User[]    @relation("AccessKeyUser")
+  createdAt  DateTime  @default(now())
+  updatedAt  DateTime  @updatedAt
+  removedAt  DateTime?
+}
+
+
+// ---------------------------------------------------------
+//
+//  CECILIANS AND ARCHIVE ITEMS
+//
+// ---------------------------------------------------------
+
+model Cecilian {
+  id         Int     @id @default(autoincrement())
+  slug       String  @unique
+  displayName String
+  otherNames String[]
+  user       UserProfile? @relation("ProfileCecilian")
+  tags       TagOnCecilian[] /// Years, Events, Roles
+  inArchiveItems CecilianInItem[]
+  authoredArchiveItems ArchiveItem[] @relation("ItemAuthor")
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
+  deletedAt  DateTime?
+}
+
+model CecilianInItem {
+  id         Int     @id @default(autoincrement())
+  cecilian   Cecilian? @relation(fields: [cecilianId], references: [id])
+  cecilianId Int?
+  item       ArchiveItem? @relation(fields: [itemId], references: [id])
+  itemId     Int?
+  addedAt    DateTime @default(now())
+  removedAt  DateTime?
+}
+
+model ArchiveItem {
+  id              Int     @id @default(autoincrement())
+  slug            String  @unique
+  archiveRef      String
+  type            ArchiveItemType
+  associatedDate  DateTime?
+  collections     ItemInCollection[]
+  notes           String?
+  author          Cecilian? @relation("ItemAuthor", fields: [authorId], references: [id])
+  authorId        Int?
+  tags            TagOnArchiveItem[] /// Years, Events, Roles
+  cecilians       CecilianInItem[]
+  files           FileOnItem[]
+  createdAt       DateTime @default(now())
+  updatedAt       DateTime @updatedAt
+  deletedAt       DateTime?
+  createdBy       User? @relation("ItemCreatedBy", fields: [createdById], references: [id])
+  createdById     Int?
+  updatedBy       User? @relation("ItemUpdatedBy", fields: [updatedById], references: [id])
+  updatedById     Int?
+}
+enum ArchiveItemType {
+  MINUTES
+  PHOTOS
+}
+
+model ArchiveFile {
+  id          Int     @id @default(autoincrement())
+  slug        String  @unique
+  kind        ArchiveFileKind
+  name        String
+  notes       String?
+  url         String
+  items       FileOnItem[]
+  createdAt   DateTime @default(now())
+  updatedAt   DateTime @updatedAt
+  deletedAt   DateTime?
+  deletedBy   User? @relation("FileDeletedBy", fields: [deletedById], references: [id])
+  deletedById Int?
+}
+enum ArchiveFileKind {
+  TRANSCRIPTION
+  SCAN
+  PREVIOUSLY_DIGITISED
+  CREATED_DIGITALLY
+}
+
+model FileOnItem {
+  id         Int     @id @default(autoincrement())
+  file       ArchiveFile? @relation(fields: [fileId], references: [id])
+  fileId     Int?
+  item       ArchiveItem? @relation(fields: [itemId], references: [id])
+  itemId     Int?
+  addedAt    DateTime @default(now())
+  removedAt  DateTime?
+}
+
+
+// ---------------------------------------------------------
+//
+//  TAGS AND THEIR RELATIONSHIPS
+//
+// ---------------------------------------------------------
+
+model Year {
+  id         Int     @id @default(autoincrement())
+  slug       String  @unique /// e.g. 2010-2011
+  name       String
+  startDate  DateTime?
+  endDate    DateTime?
+  events     Event[] /// Backlinks
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
+  deletedAt  DateTime?
+  inTags     Tag[]
+}
+
+model Event {
+  id             Int      @id @default(autoincrement())
+  type           EventType
+  name           String
+  inherentYear   Year?    @relation(fields: [inherentYearId], references: [id])
+  inherentYearId Int?
+  roles          Role[] /// Backlinks
+  startDate      DateTime?
+  endDate        DateTime?
+  createdAt      DateTime @default(now())
+  updatedAt      DateTime @updatedAt
+  deletedAt      DateTime?
+  inTags         Tag[]
+}
+enum EventType {
+  SHOW
+  ANNIVERSARY
+  EVENT
+}
+
+model Role {
+  id              Int      @id @default(autoincrement())
+  type            RoleType
+  name            String
+  inherentEvent   Event?   @relation(fields: [inherentEventId], references: [id])
+  inherentEventId Int?
+  createdAt       DateTime @default(now())
+  updatedAt       DateTime @updatedAt
+  deletedAt       DateTime?
+  inTags          Tag[]
+}
+enum RoleType {
+  PERFORMANCE
+  PRODUCTION
+  COMMITTEE
+  SOCIETY
+}
+
+model Tag {
+  id            Int      @id @default(autoincrement())
+  type          TagType
+  role          Role?    @relation(fields: [roleId], references: [id])
+  roleId        Int?
+  event         Event?   @relation(fields: [eventId], references: [id])
+  eventId       Int?
+  year          Year?    @relation(fields: [yearId], references: [id])
+  yearId        Int?
+  createdAt     DateTime @default(now())
+  updatedAt     DateTime @updatedAt
+  deletedAt     DateTime?
+  cecilians     TagOnCecilian[]
+  archiveItems  TagOnArchiveItem[]
+}
+enum TagType {
+  YEAR
+  EVENT
+  ROLE
+}
+
+model TagOnCecilian {
+  id          Int      @id @default(autoincrement())
+  cecilian    Cecilian @relation(fields: [cecilianId], references: [id])
+  cecilianId  Int
+  tag         Tag      @relation(fields: [tagId], references: [id])
+  tagId       Int
+  addedAt     DateTime @default(now())
+  removedAt   DateTime?
+}
+
+model TagOnArchiveItem {
+  id         Int         @id @default(autoincrement())
+  item       ArchiveItem @relation(fields: [itemId], references: [id])
+  itemId     Int
+  tag        Tag         @relation(fields: [tagId], references: [id])
+  tagId      Int
+  addedAt    DateTime    @default(now())
+  removedAt  DateTime?
+}
+
+
+// ---------------------------------------------------------
+//
+//  COLLECTIONS
+//
+// ---------------------------------------------------------
+
+model ArchiveCollection {
+  id          Int     @id @default(autoincrement())
+  slug        String  @unique
+  type        ArchiveCollectionType
+  name        String
+  description String?
+  physicalLocation String? /// only relevant for type: PHYSICAL
+  owner       User? @relation("CollectionOwner", fields: [ownerId], references: [id])
+  ownerId     Int?
+  viewPerms   ArchiveCollectionViewPerms @default(PUBLIC)
+  editPerms   ArchiveCollectionEditPerms @default(OPEN)
+  items       ItemInCollection[]
+  createdAt   DateTime @default(now())
+  createdBy   User @relation("CollectionCreatedBy", fields: [createdById], references: [id])
+  createdById Int
+  updatedAt   DateTime @updatedAt
+  updatedBy   User? @relation("CollectionUpdatedBy", fields: [updatedById], references: [id])
+  updatedById Int?
+  deletedAt   DateTime?
+}
+enum ArchiveCollectionType {
+  PHYSICAL
+  SYSTEM
+  USER
+}
+enum ArchiveCollectionViewPerms {
+  PUBLIC
+  PRIVATE
+}
+enum ArchiveCollectionEditPerms {
+  OPEN
+  CLOSED
+}
+
+model ItemInCollection {
+  id           Int     @id @default(autoincrement())
+  item         ArchiveItem     @relation(fields: [itemId], references: [id])
+  itemId       Int
+  collection   ArchiveCollection @relation(fields: [collectionId], references: [id])
+  collectionId Int
+  itemIndex    String? /// e.g. P1, the index of this item in collection A1
+  addedBy      User? @relation("CollectionItemAddedBy", fields: [addedById], references: [id])
+  addedById    Int?
+  addedAt      DateTime @default(now())
+  updatedAt    DateTime @updatedAt
+  removedAt    DateTime?
+}
+
+
+// ---------------------------------------------------------
+//
+//  AUDIT LOG
+//
+// ---------------------------------------------------------
+
+model AuditLog {
+  id         Int      @id @default(autoincrement())
+  timestamp  DateTime @default(now())
+  logLine    String
+}
```


