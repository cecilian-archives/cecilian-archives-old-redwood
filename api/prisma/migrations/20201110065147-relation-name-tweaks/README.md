# Migration `20201110065147-relation-name-tweaks`

This migration has been generated by Ben Galloway at 11/10/2020, 6:51:47 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."User" DROP CONSTRAINT "User_userProfileId_fkey"

ALTER TABLE "public"."User" DROP COLUMN "userProfileId"

ALTER TABLE "public"."UserContact" ADD COLUMN "userProfileId" integer   

CREATE UNIQUE INDEX "UserProfile_userId_unique" ON "public"."UserProfile"("userId")

ALTER TABLE "public"."UserContact" ADD FOREIGN KEY ("userProfileId")REFERENCES "public"."UserProfile"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201110064634-base-schema..20201110065147-relation-name-tweaks
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource DS {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider      = "prisma-client-js"
@@ -30,9 +30,9 @@
 model User {
   id                   Int        @id @default(autoincrement())
   slug                 String     @unique // The user's ID in Auth0
-  profile              UserProfile?
+  profile              UserProfile? @relation("ProfileOwner")
   accessKey            AccessKey? @relation("AccessKeyOwner")
   verifiedByKey        AccessKey  @relation("AccessKeyUser", fields: [verifiedByKeyId], references: [id])
   verifiedByKeyId      Int
   roles                UserRole[]
@@ -60,9 +60,9 @@
   title          String?
   firstNames     String?
   lastNames      String?
   otherNames     String[]
-  contactDetails UserContact[] @relation("UserContacts")
+  contactDetails UserContact[]
   anniversary60  Anniversary60Profile? @relation("Profile60th")
   visibility     Visibility @default(VISIBLE)
   createdAt      DateTime   @default(now())
   updatedAt      DateTime   @updatedAt
@@ -74,9 +74,9 @@
 }
 model UserContact {
   id            Int          @id @default(autoincrement())
-  user          User         @relation("UserContacts", fields: [userId], references: [id])
+  user          User         @relation(fields: [userId], references: [id])
   userId        Int
   type          UserContactType
   customType    String?
   value         String
```


